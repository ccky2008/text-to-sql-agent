[
  {
    "question": "Find all EC2 instances in production environment",
    "sql_query": "SELECT e.\"instanceId\", e.\"name\", e.\"instanceType\", e.\"state\"\n    FROM \"aws_ec2\" e\n    JOIN \"configuration_item\" ci ON e.\"sysId\" = ci.\"sysId\"\n    JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('DCP-Environment')\n    AND LOWER(kv.\"value\") = LOWER('PRD')\n    AND e.\"deletedAt\" IS NULL\n    AND ci.\"deletedAt\" IS NULL\n    AND kv.\"deletedAt\" IS NULL"
  },
  {
    "question": "Show EC2 instances owned by application Opus",
    "sql_query": "SELECT e.\"instanceId\", e.\"name\", e.\"instanceType\", kv.\"value\" as app_name\n    FROM \"aws_ec2\" e\n    JOIN \"configuration_item\" ci ON e.\"sysId\" = ci.\"sysId\"\n    JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('DCP-ApplicationName')\n    AND LOWER(kv.\"value\") = LOWER('Opus')\n    AND e.\"deletedAt\" IS NULL"
  },
  {
    "question": "List all resources with tag DCP-AppRef GIT-8OQ9K2",
    "sql_query": "SELECT ci.\"class\" as resource_type, ci.\"objectId\", kv.\"value\" as app_ref\n    FROM \"configuration_item\" ci\n    JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('DCP-AppRef')\n    AND LOWER(kv.\"value\") = LOWER('GIT-8OQ9K2')\n    AND ci.\"deletedAt\" IS NULL\n    AND kv.\"deletedAt\" IS NULL"
  },
  {
    "question": "Count resources by business unit",
    "sql_query": "SELECT kv.\"value\" as business_unit, COUNT(*) as resource_count\n    FROM \"configuration_item\" ci\n    JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('DCPAccount-BUCode')\n    AND ci.\"deletedAt\" IS NULL\n    AND kv.\"deletedAt\" IS NULL\n    GROUP BY kv.\"value\"\n    ORDER BY resource_count DESC"
  },
  {
    "question": "Show me all virtual machines across AWS and Azure with their memory and CPU specs",
    "sql_query": "SELECT \n        'AWS' as cloud_provider,\n        \"name\",\n        \"instanceType\" as size,\n        \"memoryInGib\",\n        \"vCpu\",\n        \"privateIp\"\n    FROM \"aws_ec2\" \n    WHERE \"deletedAt\" IS NULL\n    UNION ALL\n    SELECT \n        'Azure' as cloud_provider,\n        \"name\",\n        \"size\",\n        \"memoryInGib\",\n        \"vCpu\",\n        \"privateIp\"\n    FROM \"azure_vm\" \n    WHERE \"deletedAt\" IS NULL"
  },
  {
    "question": "Show me all Azure storage accounts where access keys were created last year",
    "sql_query": "SELECT \n        \"name\",\n        \"kind\",\n        \"sku\",\n        \"key1CreationTime\",\n        \"key2CreationTime\",\n        \"objectId\"\n    FROM \"azure_storage_account\"\n    WHERE (\n        EXTRACT(YEAR FROM \"key1CreationTime\") = EXTRACT(YEAR FROM CURRENT_DATE) - 1\n        OR EXTRACT(YEAR FROM \"key2CreationTime\") = EXTRACT(YEAR FROM CURRENT_DATE) - 1\n    )\n    AND \"deletedAt\" IS NULL\n    ORDER BY \"key1CreationTime\" DESC, \"key2CreationTime\" DESC"
  },
  {
    "question": "Find all Azure AKS clusters that are publicly accessible",
    "sql_query": "SELECT \n        \"name\",\n        \"version\",\n        \"sku\",\n        \"fqdn\",\n        \"isPublicAccess\",\n        \"objectId\"\n    FROM \"azure_aks\"\n    WHERE \"isPublicAccess\" = true\n    AND \"deletedAt\" IS NULL\n    ORDER BY \"name\""
  },
  {
    "question": "Find all AWS EKS under group information technology business unit",
    "sql_query": "SELECT COUNT(DISTINCT(\"awseksentity\".\"sysId\")) AS \"cnt\" \n        FROM \"aws_eks\" \"awseksentity\" \n        LEFT JOIN \"configuration_item\" \"ci\" ON  \"awseksentity\".\"sysId\" = \"ci\".\"sysId\" \n        AND \"ci\".\"deletedAt\" IS NULL  \n        LEFT JOIN \"key_value\" \"tag\" ON  \"ci\".\"objectId\" = \"tag\".\"objectId\" \n        AND \"tag\".\"deletedAt\" IS NULL \n        WHERE ( 1 = 1 \n            AND EXISTS (\n            SELECT 1\n            FROM aws_account\n            LEFT JOIN configuration_item ci ON aws_account.\"sysId\" = ci.\"sysId\"\n            LEFT JOIN key_value tag ON ci.\"objectId\" = tag.\"objectId\"\n            WHERE \"tag\".\"key\" ILIKE '%DCPAccount-BuCode%'\n            AND \"tag\".\"value\" ILIKE '%GIT%'\n            AND awseksentity.\"objectId\" LIKE '%' || aws_account.\"accountId\" || '%')\n        ) \n      AND ( \"awseksentity\".\"deletedAt\" IS NULL )"
  },
  {
    "question": "Show me all AWS EC2 instances that were created this year",
    "sql_query": "SELECT \n        \"name\",\n        \"instanceId\",\n        \"instanceType\",\n        \"resourceCreationTime\",\n        \"objectId\"\n    FROM \"aws_ec2\"\n    WHERE EXTRACT(YEAR FROM \"resourceCreationTime\") = EXTRACT(YEAR FROM CURRENT_DATE)\n    AND \"deletedAt\" IS NULL\n    ORDER BY \"resourceCreationTime\" DESC"
  },
  {
    "question": "Show me all AWS EC2 instances that have AutoStartStop enabled",
    "sql_query": "SELECT \n        e.\"name\",\n        e.\"instanceId\",\n        e.\"instanceType\",\n        e.\"privateIp\",\n        e.\"objectId\",\n        kv.\"value\" as autostop_status\n    FROM \"aws_ec2\" e\n    JOIN \"key_value\" kv ON e.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('AutoStartStop') \n    AND LOWER(kv.\"value\") = LOWER('true')\n    AND e.\"deletedAt\" IS NULL"
  },
  {
    "question": "Find all AWS EC2 instances that don't have AutoStartStop configured",
    "sql_query": "SELECT \n        e.\"name\",\n        e.\"instanceId\",\n        e.\"instanceType\",\n        e.\"privateIp\",\n        e.\"objectId\"\n    FROM \"aws_ec2\" e\n    WHERE e.\"objectId\" NOT IN (\n        SELECT DISTINCT \"objectId\" \n        FROM \"key_value\" \n        WHERE LOWER(\"key\") = LOWER('AutoStartStop')\n    )\n    AND e.\"deletedAt\" IS NULL"
  },
  {
    "question": "Show me all Azure VM that have AutoStartStop disabled",
    "sql_query": "SELECT \n        vm.\"name\",\n        vm.\"vmId\",\n        vm.\"vmSize\",\n        kv.\"value\" as autostop_status\n    FROM \"azure_vm\" vm\n    JOIN \"key_value\" kv ON vm.\"objectId\" = kv.\"objectId\"\n    WHERE LOWER(kv.\"key\") = LOWER('AutoStartStop') \n    AND LOWER(kv.\"value\") = LOWER('false')\n    AND vm.\"deletedAt\" IS NULL"
  },
  {
    "question": "Show me all EC2 instances with their Environment and ApplicationName",
    "sql_query": "SELECT \n        e.\"instanceId\",\n        e.\"name\",\n        e.\"instanceType\",\n        MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('DCP-Environment') THEN kv.\"value\" END) AS \"Environment\",\n        MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('DCP-ApplicationName') THEN kv.\"value\" END) AS \"ApplicationName\"\n    FROM \"aws_ec2\" e\n    LEFT JOIN \"configuration_item\" ci ON e.\"sysId\" = ci.\"sysId\" AND ci.\"deletedAt\" IS NULL\n    LEFT JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\" AND kv.\"deletedAt\" IS NULL\n    WHERE e.\"deletedAt\" IS NULL\n    GROUP BY e.\"sysId\", e.\"instanceId\", e.\"name\", e.\"instanceType\"\n    LIMIT 100"
  },
  {
    "question": "Find all AWS accounts with tag DCPAccount-BuCode equals GIT",
    "sql_query": "SELECT \n        a.\"accountId\",\n        a.\"name\",\n        MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('DCPAccount-BuCode') THEN kv.\"value\" END) AS \"DCPAccount-BuCode\"\n    FROM \"aws_account\" a\n    LEFT JOIN \"configuration_item\" ci ON a.\"sysId\" = ci.\"sysId\" AND ci.\"deletedAt\" IS NULL\n    LEFT JOIN \"key_value\" kv ON ci.\"objectId\" = kv.\"objectId\" AND kv.\"deletedAt\" IS NULL\n    WHERE a.\"deletedAt\" IS NULL\n    AND EXISTS (\n        SELECT 1 FROM \"key_value\" kv2\n        JOIN \"configuration_item\" ci2 ON kv2.\"objectId\" = ci2.\"objectId\"\n        WHERE ci2.\"sysId\" = a.\"sysId\"\n        AND LOWER(kv2.\"key\") = LOWER('DCPAccount-BuCode')\n        AND LOWER(kv2.\"value\") = LOWER('GIT')\n        AND kv2.\"deletedAt\" IS NULL\n    )\n    GROUP BY a.\"sysId\", a.\"accountId\", a.\"name\"\n    LIMIT 100"
  }
]
