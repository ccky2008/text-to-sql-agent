{
  "soft_delete": {
    "description": "All resource tables use soft delete pattern",
    "rule": "Always include 'deletedAt IS NULL' filter to exclude deleted records",
    "applies_to": "All tables with deletedAt column"
  },
  "excluded_select_columns": {
    "description": "Internal system columns that should not appear in SELECT output",
    "columns": ["sysId", "deletedAt", "createdAt", "updatedAt"],
    "rule": "Do NOT include these columns in SELECT statements unless the user explicitly requests them by name. Note: Not all tables have all these columns - only filter those that exist. These columns may still be used in WHERE, ORDER BY, or JOIN clauses."
  },
  "standard_columns": {
    "sysId": {
      "description": "Internal system identifier (UUID)",
      "usage": "Used for internal references and joins within the system"
    },
    "objectId": {
      "description": "External resource identifier from cloud provider",
      "rules": [
        "For tables prefixed with 'aws_': Contains Amazon Resource Name (ARN)",
        "For tables prefixed with 'azure_': Contains Azure Resource ID"
      ],
      "usage": "Used to identify and reference actual cloud resources. Format varies by cloud provider."
    },
    "createdAt": {
      "description": "Record creation timestamp",
      "usage": "When the record was first inserted into the database"
    },
    "updatedAt": {
      "description": "Last modification timestamp",
      "usage": "When the record was last updated"
    },
    "deletedAt": {
      "description": "Soft delete timestamp",
      "usage": "NULL means active record, non-NULL means deleted. Always filter 'deletedAt IS NULL' for active records."
    }
  },
  "sql_conventions": [
    "Use double quotes for column and table names (PostgreSQL standard)",
    "Default schema is 'public'",
    "Use table aliases for clarity in JOINs",
    "Include LIMIT clause to prevent large result sets"
  ],
  "table_prefixes": {
    "aws_": "Amazon Web Services resources",
    "azure_": "Microsoft Azure resources"
  },
  "key_value_search": {
    "description": "Case-insensitive search for key_value table columns",
    "rule": "When searching the key_value table's 'key' and 'value' columns, use case-insensitive comparison by default. Use LOWER() function or ILIKE operator. Only use exact case-sensitive matching if the user explicitly requests case-sensitive search.",
    "applies_to": "key_value table",
    "examples": [
      "LOWER(kv.\"key\") = LOWER('tag-name')",
      "LOWER(kv.\"value\") = LOWER('tag-value')",
      "kv.\"key\" ILIKE 'tag-name'",
      "kv.\"value\" ILIKE '%partial-value%'"
    ]
  },
  "tag_aggregation": {
    "description": "When displaying tags for resources, use the tag key as column header with tag value as cell value",
    "rule": "NEVER output generic 'TAG_KEY' or 'TAG_VALUE' columns. Always use the actual tag key name as the column header. Use conditional MAX pattern: MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('TagName') THEN kv.\"value\" END) AS \"TagName\". This applies whether filtering by tag or just displaying tags. Always GROUP BY resource identifier to prevent row multiplication.",
    "applies_to": "Any query involving tags from key_value table",
    "patterns": {
      "tag_as_column": "MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('TagName') THEN kv.\"value\" END) AS \"TagName\"",
      "filter_and_display": "Use WHERE to filter, then MAX(CASE WHEN...) to display the tag value in a column named after the tag key",
      "multiple_tags": "For 'all tags' without specific names, use STRING_AGG(kv.\"key\" || '=' || kv.\"value\", ', ') AS tags"
    },
    "examples": [
      "'find accounts with DCPAccount-BuCode = GIT' -> Filter by tag AND display as: MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('DCPAccount-BuCode') THEN kv.\"value\" END) AS \"DCPAccount-BuCode\"",
      "'show EC2 with Environment tag' -> MAX(CASE WHEN LOWER(kv.\"key\") = LOWER('DCP-Environment') THEN kv.\"value\" END) AS \"Environment\"",
      "'list VMs with all their tags' -> STRING_AGG to combine into one column"
    ]
  }
}
